<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <script>
    window.name = "tab_index";
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Часовой / Главная</title>
  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="%23E0292C"><path fill-rule="evenodd" d="M6.41 0.993C7.383 0.385 8.617 0.385 9.59 0.993L14.59 4.118C15.467 4.666 16 5.628 16 6.662V16H0V6.662C0 5.628 0.533 4.666 1.41 4.118L6.41 0.993ZM3 8C3 10.908 5.381 13 8 13C10.619 13 13 10.908 13 8H10.5C10.5 9.109 9.523 10.272 8 10.272C6.477 10.272 5.5 9.109 5.5 8H3Z"/></svg>' />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;400;500;600;700&display=swap"
    rel="stylesheet" />
  <script src="src/login.js"></script>
  <script src="src/script.js"></script>
  <link rel="stylesheet" href="src/style.css" />
</head>

<body>
  <div class="container w-index">
    <header>
      <span class="logo">Часовой <span>Инструменты для работы с API Школы 21</span></span>
    </header>

    <div class="nav-cards">
      <a href="src/watchman-campus.html" onclick="return openUniqueTab(this.href, 'tab_campus')" class="nav-card">
        <div class="nav-card-icon color-k">
          <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
            <path fill-rule="evenodd"
              d="M43 4V25L39.6123 27.0859L44.874 30.2803C45.6655 30.2611 46.5198 30.3802 47.3779 30.6553L47.6426 30.7461C49.6533 31.4667 51.1012 32.873 51.4648 34.3066C51.4625 34.2972 51.4605 34.2877 51.458 34.2783L58 38.25V43.25L30 60L2 43.25V38.25L8 34.6064V17L36 0L43 4ZM3.92578 43.25L29.5 58.5264V54.9463L7.0791 41.334L3.92578 43.25ZM30.5 54.9463V58.5264L56.0732 43.25L52.9189 41.334L30.5 54.9463ZM20.8408 38.6514L26 41.8262L37.0918 35.001L31.9268 31.8223L32.8799 31.2344L39 35.001L26 43.001L19.8877 39.2393L20.7764 38.6914L15 42.25L8 38V35.7754L3.92578 38.25L30 54.0801L56.0732 38.25L51.5078 35.4775C51.4893 35.5731 51.4666 35.6687 51.4365 35.7627L51.374 35.9365C51.3694 35.948 51.3632 35.9593 51.3584 35.9707C51.582 36.5706 51.622 37.1839 51.4365 37.7627L51.374 37.9365C50.6516 39.7156 47.9299 40.4424 45.166 39.5566L44.9014 39.4668C42.2885 38.5307 40.6237 36.4373 41.0557 34.6299L41.1055 34.4512C41.1282 34.3802 41.1549 34.3111 41.1836 34.2432C40.9829 33.7047 40.9301 33.1554 41.0557 32.6299L41.1055 32.4512C41.1409 32.3407 41.1837 32.2338 41.2334 32.1309C40.9124 31.9872 40.5407 31.8893 40.123 31.8213C39.4741 31.7157 38.8007 31.6885 38.0801 31.623C36.8605 31.5122 35.4522 31.2937 34.7344 30.0908L20.8408 38.6514ZM3 42.6426L6.11719 40.75L3 38.8564V42.6426ZM53.8818 40.75L57 42.6426V38.8564L53.8818 40.75ZM9 37.5L11.6162 39.0264L14.5 40.7764V20.9463L9 17.6064V37.5ZM15.5 20.9414V40.7656L29.9717 31.8496L42 24.5V4.61523L15.5 20.9414ZM42.0342 35.6074C42.1136 35.9635 42.3005 36.3519 42.6201 36.7539C43.2157 37.5027 44.207 38.1994 45.4707 38.6045C46.7348 39.0096 47.9472 39.0191 48.8672 38.7559C49.7947 38.4903 50.3123 37.9931 50.4844 37.457C50.5286 37.3192 50.5505 37.17 50.5518 37.0117C49.3621 37.9673 47.2773 38.2332 45.166 37.5566L44.9014 37.4668C43.7581 37.0572 42.7963 36.4262 42.1123 35.6943L42.0342 35.6074ZM47.0723 31.6084C45.8083 31.2033 44.5967 31.1939 43.6768 31.457C42.749 31.7226 42.2296 32.2197 42.0576 32.7559C41.886 33.2921 42.0196 33.9986 42.6201 34.7539C43.2157 35.5027 44.207 36.1994 45.4707 36.6045C46.7348 37.0096 47.9472 37.0191 48.8672 36.7559C49.7947 36.4903 50.3123 35.9931 50.4844 35.457C50.6562 34.9208 50.5244 34.2144 49.9238 33.459C49.3283 32.71 48.3363 32.0136 47.0723 31.6084ZM35.5889 29.5645C36.0233 30.298 36.9009 30.5115 38.1709 30.627C38.8248 30.6864 39.5888 30.721 40.2832 30.834C40.8181 30.9211 41.3603 31.0614 41.8506 31.3184C42.2518 30.9549 42.7734 30.6797 43.375 30.5039C43.3617 30.5078 43.3482 30.5107 43.335 30.5146L38.6572 27.6748L35.5889 29.5645ZM9.92578 17L14.9951 20.0771L41.041 4.03223L36.0146 1.16016L9.92578 17Z" />
          </svg>
        </div>
        <div class="nav-card-title">Кампус</div>
        <div class="nav-card-subtitle">Карты кампусов</div>
      </a>
      <a href="src/watchman-peers.html" onclick="return openUniqueTab(this.href, 'tab_peers')" class="nav-card">
        <div class="nav-card-icon color-p">
          <svg width="60" height="61" viewBox="0 0 60 61" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
            <path fill-rule="evenodd"
              d="M44.5 10V20.6201L58 29V43.25H57.998L30 60.499L2.00195 43.25H2V29L15.5 20.6201V10L30 1L44.5 10ZM3.92578 43.249L29.5 59.0205V55.1865L7.20801 41.2549L3.92578 43.249ZM30.5 55.1865V59.0205L56.0732 43.249L52.79 41.2549L30.5 55.1865ZM17.5029 46.376L30 54.0752L42.4951 46.376L30 38.6201L17.5029 46.376ZM30.9473 37.9668L31 38L30.9473 38.0322L43 45.5117V37.6895L37.1973 34.0879L30.9473 37.9668ZM17 37.6895V45.5107L29.0508 38.0312L29 38L29.0518 37.9678L22.8018 34.0879L17 37.6895ZM3 37.374L9.22363 33.4834L10.1973 34.0879L9.00488 34.8281L3.92676 38.0127L16 45.4502V37.6895L3 29.6201V37.374ZM44 37.6895V45.4492L56.0723 38.0127L50.9727 34.8154L49.8018 34.0879L44 37.6895ZM53.7393 40.6621L57 42.6416V38.625L53.7393 40.6621ZM3 42.6406L6.25879 40.6611L3 38.624V42.6406ZM50.7754 33.4834L57 37.374V29.6201L50.7754 33.4834ZM23.7959 33.4707L29.5 37.0117V29.9297L23.7959 33.4707ZM30.5 37.0117L36.2031 33.4707L30.5 29.9307V37.0117ZM3.89551 29L16.5 36.8223L29.0508 29.0312L29 29L29.0518 28.9678L16.5 21.1768L3.89551 29ZM30.9473 28.9668L31 29L30.9473 29.0322L43.5 36.8223L56.1035 29L43.5 21.1768L30.9473 28.9668ZM28.1445 22.8271L24.6172 25.0381L29.5 28.0684V21.9863L28.1445 22.8271ZM30.5 18.6895V20.8096L36.3467 24.4395L35.3809 25.0381L31.8613 22.832L30.5 21.9863V28.0684L43.5 20V10.6201L30.5 18.6895ZM16.5 20L23.6523 24.4385L29.5 20.8096V18.6895L16.5 10.6201V20ZM17.3955 10L30 17.8223L42.6035 10L30 2.17676L17.3955 10Z" />
          </svg>
        </div>
        <div class="nav-card-title">Пиры</div>
        <div class="nav-card-subtitle">Проекты пира, прп и другое</div>
      </a>
      <a href="src/watchman-graph.html" onclick="return openUniqueTab(this.href, 'tab_graph')" class="nav-card">
        <div class="nav-card-icon color-m">
          <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
            <path fill-rule="evenodd"
              d="M45 9V13H44.998L44.9492 13.0293L50.5 16.499V20.8633L58 25.5V30.5H57.998L38.168 42.7578L45 46.999V50.999L30.5 59.999L16 50.999V46.999L22.6943 42.8428L23.6611 43.4199L17.8955 46.999L30.5 54.8213L43.1035 46.999L37.2178 43.3457L35.5 44.4072V48.999L30.5 51.999L25.5 48.999V44.5156L2.00195 30.5H2V25.5L9.52148 21.0127L9.5 21V16.5L16 12.6289V9L30.5 0L45 9ZM17.8955 50.999L30 58.5107V55.6885L20.1689 49.5869L17.8955 50.999ZM31 55.6885V58.5107L43.1035 50.999L40.8291 49.5869L31 55.6885ZM27.4434 48.999L30 50.5312V47.4648L27.4434 48.999ZM31 50.5312L33.5557 48.999L31 47.4648V50.5312ZM17 50.3779L19.2217 48.999L19.6953 49.293L17 47.6191V50.3779ZM41.7773 48.999L44 50.3779V47.6191L41.7773 48.999ZM26.5 48.3984L29.2461 46.751L26.5 45.1123V48.3984ZM31.7314 46.7373L34.5 48.3984V45.0254L31.7314 46.7373ZM3.93848 30.4912L30 46.0361V42.2012L7.12305 28.5557L3.93848 30.4912ZM31 42.1904V46.0137L56.0859 30.5059L52.9658 28.6113L31 42.1904ZM46.1113 23.7236V27.9355L45.8721 28.0811L30.5078 37.4736L30.25 37.3252L14 27.9434V23.6943L10.4951 21.5957L3.95117 25.5L30.4902 41.3301L56.0986 25.5L49.6611 21.5205L46.1113 23.7236ZM15 27.3652L30.4922 36.3105L45.1113 27.374V24.3447L30.3672 33.5L15 24.2939V27.3652ZM10.5 20.4004L13.2676 18.7422L14.2734 19.3408L11.4688 21.0146L30 32.1133V28.7012L10.5 17.0938V20.4004ZM31 28.6865V31.9287L48.6035 21L45.9424 19.3477L46.9893 18.6934L49.5 20.2451V17.124L31 28.6865ZM3 29.8916L6.15234 27.9766L3 26.0957V29.8916ZM53.9199 28.0215L57 29.8916V26.1172L53.9199 28.0215ZM11.4551 16.499L30.4873 27.8271L48.6133 16.499L44.0029 13.6172L41.5 15.1699V18.7539L30.5 25.4785L19.5 18.7539V15.3984L16.4131 13.5469L11.4551 16.499ZM30.5 21.999L20.5 15.999V18.1924L30.5 24.3057L40.5 18.1924V15.791L30.5 21.999ZM17.3955 12.999L30 20.5225V17.6895L19.9668 11.4619L17.3955 12.999ZM31 17.6895V20.5107L43.0576 13.0264L40.793 11.6104L31 17.6895ZM17.8955 9L30.5 16.8223L43.1035 9L30.5 1.17676L17.8955 9ZM41.7783 10.999L44 12.3779V9.62012L41.7783 10.999ZM17 12.0332L18.9834 10.8516L17 9.62012V12.0332Z" />
          </svg>
        </div>
        <div class="nav-card-title">Дерево</div>
        <div class="nav-card-subtitle">Граф проектов</div>
      </a>
      <a href="src/watchman-fullapi.html" onclick="return openUniqueTab(this.href, 'tab_api')" class="nav-card">
        <div class="nav-card-icon color-a">
          <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
            <path fill-rule="evenodd"
              d="M22 0C27.996 0 32.964 2.7487 33.8564 6.33984L44 12.499V23L44.1562 23.2578C44.3952 23.4947 44.6154 23.7384 44.8115 23.9922L58 32V43L30 60L2 43V21L10.5732 15.793C10.6123 15.8691 10.6534 15.9446 10.6963 16.0195C10.2467 15.2318 10 14.3842 10 13.5C9.99967 11.7504 9.99999 9.25094 10 7.74902C10.0023 7.74902 10.0046 7.74902 10.0068 7.74902C10.0071 7.75391 10.0075 7.75879 10.0078 7.76367C10.003 7.67614 10 7.58826 10 7.5C10 3.35786 15.3726 0 22 0ZM3.92578 43L29.5 58.5264V48.6963L12.0205 38.084L3.92578 43ZM30.5 48.6963V58.5264L56.0732 43L47.9775 38.084L30.5 48.6963ZM45.7539 25.7344C45.9147 26.224 46 26.7307 46 27.25C46 27.3337 45.9965 27.417 45.9922 27.5C45.9948 27.5 45.9974 27.501 46 27.501V33.251C46 37.3931 40.6275 40.751 34 40.751C29.1158 40.7508 24.9158 38.925 23.043 36.3076L17.0332 39.957L30 47.8301L56.0732 32L45.7539 25.7344ZM3 42.3926L11.0586 37.5L3 32.6064V42.3926ZM48.9404 37.5L57 42.3926V32.6064L48.9404 37.5ZM45 30.2471C43.1487 32.8966 38.9215 34.75 34 34.75C29.0785 34.75 24.8513 32.8966 23 30.2471V33.251C23 34.8527 24.0421 36.4541 26.0449 37.7061C28.0338 38.9491 30.8439 39.7509 34 39.751C37.1562 39.751 39.9671 38.9491 41.9561 37.7061C43.9589 36.4542 45 34.8527 45 33.251V30.2471ZM22.3613 25.4199C22.3243 25.5121 22.2893 25.6047 22.2578 25.6982L16.5 29.1953V39.1094L22.5254 35.4502C22.1845 34.7546 22 34.0164 22 33.251C21.9997 31.5014 22 29.0019 22 27.5C22.0023 27.5 22.0046 27.5 22.0068 27.5C22.0071 27.5055 22.0075 27.5111 22.0078 27.5166C22.0029 27.4281 22 27.3392 22 27.25C22 26.6185 22.1262 26.0058 22.3613 25.4199ZM3 31.3926L11.0586 26.5L12.0215 27.084L3.92578 32L15.5 39.0264V29.1953L3 21.6055V31.3926ZM34 20.75C30.8438 20.75 28.0339 21.5518 26.0449 22.7949C24.0418 24.0469 23 25.6481 23 27.25C23 28.8519 24.0418 30.4531 26.0449 31.7051C28.0339 32.9482 30.8438 33.75 34 33.75C37.1562 33.75 39.9661 32.9482 41.9551 31.7051C43.9582 30.4531 45 28.8519 45 27.25C45 25.6481 43.9582 24.0469 41.9551 22.7949C39.9661 21.5518 37.1562 20.75 34 20.75ZM29.0127 20.4277L42.0732 12.499L33.998 7.59473C33.9984 7.57846 33.9979 7.56218 33.998 7.5459C33.9971 7.61382 33.9957 7.68152 33.9922 7.74902C33.9948 7.74902 33.9974 7.75 34 7.75V13.5C34 17.6422 28.6275 21 22 21C17.1681 20.9999 13.0055 19.2131 11.1035 16.6406L3.92578 20.999L16 28.3291L23.2314 23.9375C24.4515 22.3912 26.499 21.1466 29.0127 20.4277ZM38.8994 20.4033C40.4956 20.8501 41.9065 21.5084 43.042 22.3213C43.028 22.3113 43.0141 22.301 43 22.291V13.1055L31.8555 19.8701C32.5513 19.7917 33.268 19.75 34 19.75C34.7122 19.75 35.4098 19.7909 36.0879 19.8652L33.9775 18.584L34.9404 18L38.8994 20.4033ZM33 10.4971C31.1487 13.1466 26.9215 15 22 15C17.0785 15 12.8513 13.1466 11 10.4971V13.5C11 15.1018 12.0421 16.7032 14.0449 17.9551C16.0338 19.1981 18.8439 19.9999 22 20C25.1562 20 27.9671 19.1981 29.9561 17.9551C31.9589 16.7032 33 15.1018 33 13.5V10.4971ZM22 1C18.8438 1 16.0339 1.80181 14.0449 3.04492C12.0418 4.29686 11 5.89814 11 7.5C11 9.10186 12.0418 10.7031 14.0449 11.9551C16.0339 13.1982 18.8438 14 22 14C25.1562 14 27.9661 13.1982 29.9551 11.9551C31.9582 10.7031 33 9.10186 33 7.5C33 5.89814 31.9582 4.29686 29.9551 3.04492C27.9661 1.80181 25.1562 1 22 1Z" />
          </svg>
        </div>
        <div class="nav-card-title">Апишка</div>
        <div class="nav-card-subtitle">Упрощенный API</div>
      </a>
    </div>

    <div class="login-cont">
      <div class="status-card">
        <div class="status-header">
          <div class="status-title">Статус</div>
          <div class="status-right">
            <div class="status-indicators-grid">
              <div class="status-indicator-item">
                <span class="status-label">Платформа:</span>
                <span class="status-value" id="status-ind-platform">...</span>
              </div>
              <div class="status-indicator-item">
                <span class="status-label">localhost:</span>
                <span class="status-value" id="status-ind-localhost">...</span>
              </div>
              <div class="status-indicator-item">
                <span class="status-label">Телеграм:</span>
                <span class="status-value" id="status-ind-telegram">...</span>
              </div>
            </div>
          </div>
        </div>

        <div class="status-grid">
          <div class="status-column">
            <div class="status-column-title">Платформа Школы 21</div>

            <div class="input-group">
              <label>Логин</label>
              <div class="input-wrapper">
                <input type="text" id="s21-login" placeholder="login" />
              </div>
              <div class="helper-text">Например, watchman</div>
            </div>

            <div class="input-group">
              <label>Пароль</label>
              <div class="input-wrapper">
                <input type="password" id="s21-pass" placeholder="****************" />
              </div>
              <div class="helper-text">
                Нужен только для получения токена API школы
              </div>
            </div>
          </div>

          <div class="status-column">
            <div class="status-column-title">Телеграм для уведомлений</div>

            <div class="input-group">
              <label>Токен бота</label>
              <div class="input-wrapper">
                <input type="text" id="tg-token" placeholder="xxxxxxxx:xxxxxxxxxxxxxxxxxxxx" />
              </div>
              <div class="helper-text">
                Бота можно создать через
                <a href="https://t.me/BotFather" target="_blank">@BotFather</a>
              </div>
            </div>

            <div class="input-group">
              <label>Айди пользователя</label>
              <div class="input-wrapper">
                <input type="text" id="tg-id" placeholder="xxxxxxxxx" />
              </div>
              <div class="helper-text">
                Сюда приходят уведомления. Узнать через
                <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a>
              </div>
            </div>
          </div>
        </div>

        <div class="status-actions">
          <button class="check-btn" id="check-btn">Проверить</button>
          <label class="checkbox-label">
            <input type="checkbox" id="save-creds" />
            Сохранить в браузере
          </label>
        </div>
      </div>

      <div class="instructions-block">
        <div class="instructions-header" onclick="toggleInstructions(this)">
          <span>Инструкции</span>
          <span class="toggle-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </span>
        </div>
        <div class="instructions-body">
          <h4>Сервер</h4>
          <p>
            Часовой работает в браузере, поэтому для доступа к API нужно
            запустить локальный сервер.
          </p>

          <p>
            Запуск сервера: <strong>python3 start.py</strong> или
            <strong>python start.py</strong> в терминале.<br /><br />
          </p>

          <h4>Логин и пароль</h4>
          <p>
            Доступ к API возможен только с логином и паролем Платформы Школы
            21.
          </p>
          <p>
            Логин и пароль можно сохранить в браузере или вводить каждый раз вручную.
          </p>
          <p>
            Если не нажать &laquo;Запомнить данные в браузере&raquo;, то логин
            и пароль удалятся при завершении сессии.<br /><br />
          </p>

          <h4>Телеграм</h4>
          <p>
            Несколько скриптов дают возможность получать
            обновления в Телеграм. Это не обязательный функционал и поля
            доступа к Телеграм можно не заполнять.
          </p>
          <p>
            Создать телеграм-бота можно через
            <a href="https://t.me/BotFather" target="_blank">@BotFather</a>.
            Нужно получить токен бота.
          </p>
          <p>
            Узнать свой ID в Телеграм можно через
            <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a>.
          </p>
        </div>
      </div>
    </div>

    <footer class="page-footer">
      <div class="footer-left">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="#7D838E" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M5.667 0C5.667 0.952 6.578 1.951 8 1.951C9.422 1.951 10.333 0.952 10.333 0H12.667C12.667 1.139 12.203 2.131 11.467 2.874C13.577 4.084 15 6.362 15 8.976C15 12.855 11.866 16 8 16C4.134 16 1 12.855 1 8.976C1 6.363 2.422 4.084 4.532 2.874C3.797 2.131 3.333 1.139 3.333 0H5.667ZM8 4.293C5.423 4.293 3.333 6.389 3.333 8.976C3.333 11.562 5.423 13.659 8 13.659C10.577 13.659 12.667 11.562 12.667 8.976C12.667 6.389 10.577 4.293 8 4.293Z" />
        </svg>
        <span class="motto"><a href="https://github.com/rafikov/watchman">Часовой</a> на гите</span>
      </div>
    </footer>
  </div>

  <script>
    window.toggleInstructions = (header) => {
      header.parentElement.classList.toggle("expanded");
    };

    const s21LoginInput = document.getElementById("s21-login");
    const s21PassInput = document.getElementById("s21-pass");
    const tgTokenInput = document.getElementById("tg-token");
    const tgIdInput = document.getElementById("tg-id");
    const saveCredsCheckbox = document.getElementById("save-creds");
    const checkBtn = document.getElementById("check-btn");

    function loadCredentials() {
      let stored = localStorage.getItem("watchman_creds");
      let fromLocal = true;

      if (!stored) {
        const match = document.cookie.match(
          new RegExp("(^| )watchman_creds=([^;]+)")
        );
        if (match) {
          try {
            stored = decodeURIComponent(match[2]);
            fromLocal = false;
          } catch (e) { }
        }
      }

      if (stored) {
        try {
          const creds = JSON.parse(stored);
          if (creds.s21Login) s21LoginInput.value = creds.s21Login;
          if (creds.s21Pass) s21PassInput.value = creds.s21Pass;
          if (creds.tgToken) tgTokenInput.value = creds.tgToken;
          if (creds.tgId) tgIdInput.value = creds.tgId;
          saveCredsCheckbox.checked = fromLocal;
        } catch (e) {
          console.error("Failed to parse credentials", e);
        }
      }
    }

    function saveCredentials() {
      const creds = {
        s21Login: s21LoginInput.value,
        s21Pass: s21PassInput.value,
        tgToken: tgTokenInput.value,
        tgId: tgIdInput.value,
      };

      if (saveCredsCheckbox.checked) {
        localStorage.setItem("watchman_creds", JSON.stringify(creds));
        document.cookie = "watchman_creds=; max-age=0; path=/";
      } else {
        document.cookie =
          "watchman_creds=" +
          encodeURIComponent(JSON.stringify(creds)) +
          "; path=/";
        localStorage.removeItem("watchman_creds");
      }
    }
    async function performCheck() {
      checkBtn.disabled = true;
      checkBtn.classList.add("disabled");
      const originalText = checkBtn.textContent;
      checkBtn.textContent = "Проверка...";

      const delayPromise = new Promise(resolve => setTimeout(resolve, 600));

      try {
        const user = s21LoginInput.value.trim();
        const pass = s21PassInput.value.trim();
        const tgToken = tgTokenInput.value.trim();
        const tgId = tgIdInput.value.trim();

        if (!user || !pass) {
          alert("Пожалуйста, заполните логин и пароль");
          return;
        }

        const isProxyOnline = await checkProxy();

        if (user && pass) {
          if (isProxyOnline) {
            try {
              await getAccessToken(user, pass, true);
            } catch (e) {
              console.warn("Auth failed", e);
              alert(
                "Ошибка авторизации: " + (e.message || "Неизвестная ошибка")
              );
            }
          }
        }

        if (tgToken) {
          try {
            await verifyTelegramBot(tgToken);
          } catch (e) {
            console.warn("Telegram verification failed", e);
          }
        }

        saveCredentials();
        if (typeof checkSystemStatus === "function") {
          await checkSystemStatus();
        }
        await delayPromise;
      } catch (e) {
        console.error("Unexpected error:", e);
        alert("Произошла ошибка: " + e.message);
      } finally {
        checkBtn.disabled = false;
        checkBtn.classList.remove("disabled");
        checkBtn.textContent = originalText;
      }
    }

    window.addEventListener("load", () => {
      loadCredentials();
    });

    checkBtn.addEventListener("click", performCheck);
  </script>
</body>

</html>