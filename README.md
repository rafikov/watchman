# Вахтёр
Набор скриптов для работы с API Школы 21. Работает в браузере, не требует установки и компиляции.

Требует запуск локального сервера и наличие логина и пароля на Платформе Школы 21 для доступа к API.

Все скрипты настроены для работы с API на момент публикации https://platform.21-school.ru/docs

**Вахтёр содержит несколько модулей:**
- Главная
- Монетки
- Пиры
- Кампус
- Айпишка

## Главная
<img width="1400" height="1069" alt="vahter-index" src="https://github.com/user-attachments/assets/fdd2b499-bad1-4e5e-8201-527023fa455c" />

На главной странице происходит ввод данных для авторизации и проверка статуса локального сервера.

При нажатии на кнопки в списке страниц, открывается нужный модуль.

## Кампус
![preview-maps](https://github.com/user-attachments/assets/2b3bbfff-189f-4395-8819-8fcd7f1b60c4)

Выводятся карты кампусов для всех городов Школы.

Отображены статусы свободно/занято.

Для пиров в кампусе отображается всплывающий тултип с информацией пира.

Возможна подписка на друзей и получение уведомлений о логине/разлогинивании.

## Айпишка
![preview-api](https://github.com/user-attachments/assets/380ce4d6-90e2-43d3-be20-4067899edb46)

Конструктор запросов API. Параметры кэшируются заранее и отображаются в выпадающих списках. Есть возможность добавлять избранные параметры "в память".

Отображается структура ответа от API в виде кода.

## Монетки
![preview-coins](https://github.com/user-attachments/assets/f5b67c24-935d-46aa-89e6-c9147c17d609)

Список друзей и пиров со статистикой изменения количества монеток.

Возможна подписка на статусы.

## Пиры
![preview-peers](https://github.com/user-attachments/assets/24af1824-794c-4e6f-a1ed-8eb2b9ddf393)

Список друзей и пиров с подробными карточками данных по XP, PRP, уровню и актуальный список проектов.

Возможна подписка на статусы.

## Работа с паролями

Есть несколько способов хранить пароли:

**Способ 1:**
В файле **src/login.js** можно записать все логины и пароли в самом начале файла

**Способ 2:**
На главной странице http://localhost:8000/ можно ввести логины и пароли в форму и выбрать "Запомнить данные в браузере". Данные будут храниться в локальном хранилище браузера

**Способ 3:**
На главной странице http://localhost:8000/ можно ввести логины и пароли в форму и не сохранять данные в браузере. Будет создан куки с логином и паролем, который удаляется при закрытии или обновлении главной страницы.

## Уведомления в Телеграм (не обязательно)

Несколько скриптов позволяют получать уведомления в Телеграм.

Создать телеграм бота можно через @BotFather. Нужно получить токен бота.

Узнать свой ID в Телеграм можно через @userinfobot

## Запуск локального сервера

Для работы нужно запустить Питон-скрипт (он включит localhost и cors proxy).

**1. Проверить, установлен ли Питон**
```
python3 --version или python --version
```

**2. Установить Питон, если его нет:**

- Мак:
```
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew install python
```

- Убунту:
```
sudo apt update
sudo apt install python3
sudo apt install python3-pip
```

- Виндовс:
Скачать с сайта python.org или
```
wsl --install
```
Повторить команды для Линукс

**3. Установить зависимости:**
Зависимости Питона перечислены в файле requirements.txt
```
requests>=2.28.0
urllib3>=1.26.0
```
Если возникают сообщения об отсутствии какой-то из библиотек:
```
pip install -r requirements.txt
```

**4. Запустить сервер:**
Запустить сервер в директории со скриптом через
```
python3 start.py или python start.py
```

**5. Открыть в браузере:**
- Главная: http://localhost:8000/
- Кампус: http://localhost:8000/src/watchman-campus.html
- Айпишка: http://localhost:8000/src/watchman-fullapi.html
- Монетки: http://localhost:8000/src/watchman-coins.html
- Пиры: http://localhost:8000/src/watchman-peers.html

**6. Для остановки Питон-скрипта:** **Ctrl + C**

## Настройка шаблонов карты кампуса

По умолчанию, все кластеры кампусов отображаются в том порядке, в котором их передает API. Но можно настроить отображение нужного кампуса в файле с шаблонами **src/maps.js**

Нужно найти id своего кампуса и добавить новый элемент в файл:

```
const CAMPUS_TEMPLATES = {
    '5a23bec9-f989-485d-935b-3f0dc61c4812': [
        …
        { type: 'cluster', name: 'Kulibin', align: 'right' },
    ],
    'another-campus-id': [
        { type: 'cluster', name: 'Neutron', align: 'left' },
        { type: 'building', name: 'Proton', align: 'right' }
    ]
};
```

## Дебаггинг

Для страниц Монетки, Пиры и Кампус есть возможность запуска скрипта для дебаггинга HTML элементов. Нужно подключить скрипт в конце файла перед </body>

```
<script src="debug.js"></script>
```

При нажатии комбинации клавиш **Ctrl + Shift + D** происходят изменения на странице.

## Исполняемые файлы

Проект можно запускать в два клика.

В папке **/exe** лежат 3 исполняемых файла. Возможно, придется дать файлу права на исполнение (chmod +x watchman.exe).

Исполняемый файл для своей платформы нужно переложить в директорию, в которой лежит файл start.py

- exe/watchman.bat - Windows
- exe/watchman.sh - Linux
- exe/watchman.command - Mac

## Важно

Проект существует только для образовательного/персонального использования. Используйте код на свой риск. Автор передает код как есть, и не несет обязательств.
